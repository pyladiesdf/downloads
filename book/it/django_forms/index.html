
<!DOCTYPE HTML>
<html lang="it" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Form Django · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-richquotes/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sidebar-ad/sidebar-ad.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codeblock-label/block.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sectionx/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../whats_next/" />
    
    
    <link rel="prev" href="../extend_your_application/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
  
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Scrivi per cercare" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://gitter.im/DjangoGirls/tutorial" target="_blank" class="custom-link">Need help? Talk to us!</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduzione
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../installation/">
            
                <a href="../installation/">
            
                    
                    Installazione
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../how_the_internet_works/">
            
                <a href="../how_the_internet_works/">
            
                    
                    Come funziona Internet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../intro_to_command_line/">
            
                <a href="../intro_to_command_line/">
            
                    
                    Introduzione al command line
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../python_installation/">
            
                <a href="../python_installation/">
            
                    
                    Installazione di Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../code_editor/">
            
                <a href="../code_editor/">
            
                    
                    Code Editor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../python_introduction/">
            
                <a href="../python_introduction/">
            
                    
                    Introduzione a Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../django/">
            
                <a href="../django/">
            
                    
                    Che cos'è Django?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../django_installation/">
            
                <a href="../django_installation/">
            
                    
                    Installazione di Django
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../django_start_project/">
            
                <a href="../django_start_project/">
            
                    
                    Il tuo primo progetto Django!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../django_models/">
            
                <a href="../django_models/">
            
                    
                    I modelli di Django
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../django_admin/">
            
                <a href="../django_admin/">
            
                    
                    L'admin di Django
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../deploy/">
            
                <a href="../deploy/">
            
                    
                    Deploy!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../django_urls/">
            
                <a href="../django_urls/">
            
                    
                    Django URL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../django_views/">
            
                <a href="../django_views/">
            
                    
                    Le views di Django - è arrivata l'ora di creare!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../html/">
            
                <a href="../html/">
            
                    
                    Introduzione all'HTML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../django_orm/">
            
                <a href="../django_orm/">
            
                    
                    ORM di Django (Querysets)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../dynamic_data_in_templates/">
            
                <a href="../dynamic_data_in_templates/">
            
                    
                    I dati dinamici in templates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="../django_templates/">
            
                <a href="../django_templates/">
            
                    
                    I templates di Django
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="../css/">
            
                <a href="../css/">
            
                    
                    CSS - dagli un bell'aspetto
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="../template_extending/">
            
                <a href="../template_extending/">
            
                    
                    Estendere il template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="../extend_your_application/">
            
                <a href="../extend_your_application/">
            
                    
                    Estendi la tua applicazione
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.23" data-path="./">
            
                <a href="./">
            
                    
                    Form Django
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="../whats_next/">
            
                <a href="../whats_next/">
            
                    
                    Quali sono le prospettive?
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Pubblicato con GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
  <div class="sidebar-addition">
      
        <a href="https://store.djangogirls.org/" target="_blank">
      
        <img src="https://cdn.shopify.com/s/files/1/0992/7712/products/codelikeagirl---mockup4_large.jpg" />
      
        </a>
      
      
        <p>💖 Support our work and buy a Django Girls t-shirt! ✨</p>
      
      
      <a href="https://store.djangogirls.org/" class="btn" target="_blank">
        Get a t-shirt!
      </a>
      
  </div>

    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Form Django</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="i-form-di-django">I form di Django</h1>
<p>Infine vogliamo creare un bel modo per poter aggiungere e cambiare in nostri blog posts. Django <code>admin</code> &#xE8; bello, ma &#xE8; alquanto difficile da personalizzare e rendere carino. Con i <code>forms</code> avremo il potere assoluto sull&apos;aspetto della nostra pagina web-possiamo fare praticamente qualsiasi cosa vogliamo!</p>
<p>La bella cosa dei Django forms &#xE8; che possiamo sia inventare un nuovo form da zero che creare un <code>ModelForm</code> che salver&#xE0; il risultato del form sul nostro modello.</p>
<p>Questo &#xE8; esattamente quello che stiamo per fare: stiamo per creare un form per il nostro modello dei <code>Post</code>.</p>
<p>Come ogni parte importante di Django, i forms hanno il proprio file: <code>forms.py</code>.</p>
<p>Dobbiamo creare un file con questo nome all&apos;interno della cartella <code>blog</code>.</p>
<pre><code>blog
   &#x2514;&#x2500;&#x2500; forms.py
</code></pre><p>OK, apriamo questo file e inseriamo:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> django <span class="hljs-keyword">import</span> forms

<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Post

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostForm</span><span class="hljs-params">(forms.ModelForm)</span>:</span>

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        model = Post
        fields = (<span class="hljs-string">&apos;title&apos;</span>, <span class="hljs-string">&apos;text&apos;</span>,)
</code></pre>
<p>Dobbiamo importare prima di tutto i Django Forms (<code>from django import forms</code>) e, ovviamente, il nostro <code>Post</code> model (<code>from .models import Post</code>).</p>
<p><code>PostForm</code>, come probabilmente hai intuito, &#xE8; il nome del nostro form. Dobbiamo ora dire a Django che questa form &#xE9; una <code>ModelForm</code> (cos&#xEC; Django far&#xE0; qualche magia per noi)- <code>forms.ModelForm</code> &#xE8; il comando per farlo.</p>
<p>Successivamente, abbiamo <code>class Meta</code>, con cui diciamo a Django quale model utilizzare per creare questo form (<code>model = Post</code>).</p>
<p>Finalmente possiamo indicare uno o pi&#xF9; campi che il nostro form deve avere. In questo caso vogliamo che solamente <code>title</code> e <code>text</code> siano visibili -<code>author</code> &#xE8; la persona attualmente connessa (tu!) e <code>created_date</code> dovrebbe generarsi da sola ogni volta che creiamo un post (cio&#xE8; nel nostro programma), giusto?</p>
<p>E questo &#xE8; tutto! Tutto quello che dobbiamo fare ora &#xE9; usare il form nella nostra <em>view</em> e visualizzarlo nel template.</p>
<p>Ricapitolando, creeremo: link che punti alla pagina, una URL, una view e un model.</p>
<h2 id="link-ad-una-pagina-usando-il-form">Link ad una pagina usando il form</h2>
<p>&#xC8; tempo di aprire <code>blog/templates/blog/base.html</code>. Aggiungeremo un link nel <code>div</code> chiamato <code>page-header</code>:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>Nota che vogliamo chiamare la nostra nuova view <code>post_new</code>.</p>
<p>Dopo aver aggiunto quanto detto, il tuo file html dovrebbe essere simile a questo:</p>
<pre><code class="lang-html">{% load staticfiles %}
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Django Girls blog<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&apos;//fonts.googleapis.com/css?family=Lobster&amp;subset=latin,latin-ext&apos;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&apos;stylesheet&apos;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&apos;text/css&apos;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% static &apos;css/blog.css&apos; %}&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-header&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>Django Girls Blog<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content container&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-8&quot;</span>&gt;</span>
                    {% block content %}
                    {% endblock %}
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Dopo aver salvato e aggiornato la pagina <a href="http://127.0.0.1:8000" target="_blank">http://127.0.0.1:8000</a> vedrai ovviamente un errore familiare <code>NoReverseMatch</code>, giusto?</p>
<h2 id="url">URL</h2>
<p>Apri il file <code>blog/urls.py</code> e aggiungi:</p>
<pre><code class="lang-python">    url(<span class="hljs-string">r&apos;^post/new/$&apos;</span>, views.post_new, name=<span class="hljs-string">&apos;post_new&apos;</span>),
</code></pre>
<p>Il risultato finale sar&#xE0;:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url
<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views

urlpatterns = [
    url(<span class="hljs-string">r&apos;^$&apos;</span>, views.post_list, name=<span class="hljs-string">&apos;post_list&apos;</span>),
    url(<span class="hljs-string">r&apos;^post/(?P&lt;pk&gt;[0-9]+)/$&apos;</span>, views.post_detail, name=<span class="hljs-string">&apos;post_detail&apos;</span>),
    url(<span class="hljs-string">r&apos;^post/new/$&apos;</span>, views.post_new, name=<span class="hljs-string">&apos;post_new&apos;</span>),
]
</code></pre>
<p>Dopo aver aggiornato il sito, vedremo un <code>AttributeError</code> dal momento che non abbiamo ancora creato <code>post_new</code>. Aggiungiamolo adesso.</p>
<h2 id="postnew-view">post_new view</h2>
<p>Apri il file <code>blog/views.py</code> e aggiungi quanto segue con il resto delle importazioni <code>from</code>:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> .forms <span class="hljs-keyword">import</span> PostForm
</code></pre>
<p>e la nostra <em>view</em>:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_new</span><span class="hljs-params">(request)</span>:</span>
    form = PostForm()
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Per creare un nuovo <code>Post</code> form, dobbiamo chiamare il metodo <code>PostForm()</code> e passarlo nel nostro template. Torneremo poi sulla <em>view</em>, ma per ora creiamo un veloce template per il nostro form.</p>
<h2 id="template">Template</h2>
<p>All&apos;interno della cartella <code>blog/templates/blog</code> dobbiamo creare il file <code>post_edit.html</code>. Per far si che il nostro form funzioni abbiamo bisogno di diverse cose:</p>
<ul>
<li>dobbiamo rendere il form visibile. Per farlo possiamo usare semplicemente <code>{{ form.as_p }}</code>.</li>
<li>le righe scritte sopra hanno bisogno di &apos;essere avvolte&apos; da un HTML tag: <code>&lt;form method=&quot;POST&quot;&gt;...&lt;/form&gt;</code></li>
<li>ci serve un <code>Save</code> pulsante. Possiamo fare ci&#xF2; con HTML button: <code>&lt;button type=&quot;submit&quot;&gt;Save&lt;/button&gt;</code></li>
<li>infine, subito dopo l&apos;apertura del tag <code>&lt;form ...&gt;</code>, dobbiamo aggiungere <code>{% csrf_token %}</code>. Questo passaggio &#xE8; molto importante dal momento che rende il nostro form sicuro! Django si lamenter&#xE0; se ti dimentichi di inserire questa parte e provi comunque a salvare ci&#xF2; che &#xE8; contenuto nel form:</li>
</ul>
<p><img src="images/csrf2.png" alt="CSFR Forbidden page"></p>
<p>OK, il tuo HTML <code>post_edit.html</code> dovrebbe apparire cos&#xEC;:</p>
<pre><code class="lang-html">{% extends &apos;blog/base.html&apos; %}

{% block content %}
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>New post<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-form&quot;</span>&gt;</span>{% csrf_token %}
        {{ form.as_p }}
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;save btn btn-default&quot;</span>&gt;</span>Save<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
{% endblock %}
</code></pre>
<p>Ora aggiorna la pagina! Yeah! Puoi ora visualizzare il tuo form!</p>
<p><img src="images/new_form2.png" alt="New form"></p>
<p>Ma, aspetta un momento! Se provi a scrivere qualcosa in <code>title</code> e <code>text</code> e cerchi di salvare ci&#xF2; che hai scritto, che cosa succede?</p>
<p>Niente! Siamo di nuovo sulla stessa pagina di prima e il nostro testo &#xE9; sparito...e non compare nessun nuovo post. Che cosa abbiamo sbagliato?</p>
<p>La risposta &#xE8;: nulla. Dobbiamo solo fare un po&apos; di lavoro in pi&#xF9; nella nostra <em>view</em>.</p>
<h2 id="salvare-il-form">Salvare il form</h2>
<p>Apri <code>blog/views.py</code> di nuovo. Attualmente tutto ci&#xF2; che abbiamo nella view <code>post_new</code> &#xE9;:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_new</span><span class="hljs-params">(request)</span>:</span>
    form = PostForm()
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Quando inviamo il form, veniamo riportati alla stessa view, ma questa volta abbiamo pi&#xF9; dati in <code>request</code>, in particolare in <code>request.POST</code> (il nome non ha nulla a che vedere con un blog &quot;post&quot;, bens&#xEC; con l&apos;inglese &quot;posting&quot;, ovvero inviare, in questo caso dati). Ti ricordi che nel nostro file HTML il nostro <code>&lt;form&gt;</code> aveva la variabile <code>method=&quot;POST&quot;</code>? Per cui ora, tutto quello che l&apos;utente ha inserito nel form &#xE8; disponibile in <code>method=&quot;POST&quot;</code>. Non &#xE8; necessario rinominare <code>POST</code> in nessuna altra maniera (l&apos;unico altro valore valido per <code>method</code> &#xE8; <code>GET</code>, ma al momento non abbiamo abbastanza tempo per spiegare la differenza).</p>
<p>Per cui nella nostra <em>view</em> abbiamo due diverse situazioni da gestire. Prima: quando accediamo alla pagina per la prima volta e vogliamo un form che sia vuoto. Seconda: quando torniamo alla <em>view</em> con tutti i dati appena inseriti nel form. Per cui dobbiamo aggiungere una condizione(useremo <code>if</code>).</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:
    [...]
<span class="hljs-keyword">else</span>:
    form = PostForm()
</code></pre>
<p>&#xC8; ora di completare i puntini <code>[...]</code>. Se il <code>method</code> &#xE8; <code>POST</code> allora vogliamo costruire il nostro <code>PostForm</code> con i dati appena inseriti dall&apos;utente, giusto? Raggiungeremo questo risultato con:</p>
<pre><code class="lang-python">form = PostForm(request.POST)
</code></pre>
<p>Facile! Come prossima cosa dobbiamo controllare se il form &#xE8; corretto (per cui che tutti i campi necessari siano stati impostati e che non ci siano valori sbagliati). Possiamo fare questo con <code>form.is_valid()</code>.</p>
<p>Se il form viene ritenuto valido verr&#xE0; salvato!</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> form.is_valid():
    post = form.save(commit=<span class="hljs-keyword">False</span>)
    post.author = request.user
    post.published_date = timezone.now()
    post.save()
</code></pre>
<p>In pratica, ci sono due cose da fare: salviamo il form con <code>form.save</code> e aggiungiamo un autore (dal momento che non c&apos;era nessun campo autore <code>author</code> nel form <code>PostForm</code> e questo campo non pu&#xF2; essere lasciato bianco!). <code>commit=False</code> significa che non vogliamo salvare <code>Post</code> model per il momento-vogliamo prima assicurarci di aggiungere un autore. Per la maggior parte del tempo userai <code>form.save()</code>, senza <code>commit=False</code>, ma in questo caso abbiamo bisogno di questa extra specificazione. <code>post.save()</code> salver&#xE0; le modifiche (aggiunta di autore) e il nuovo post del tuo blog &#xE8; stato finalmente creato!</p>
<p>Infine, non sarebbe fantastico se potessimo immediatamente essere indirizzati alla pagina <code>post_detail</code> del nuovo blog post appena creato? Per fare ci&#xF2; dobbiamo importare:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> redirect
</code></pre>
<p>Aggiungilo all&apos;inizio del file. E ora possiamo dire: vai alla pagina <code>post_detail</code> per il post appena creato.</p>
<pre><code class="lang-python"><span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&apos;post_detail&apos;</span>, pk=post.pk)
</code></pre>
<p><code>post_detail</code> &#xE9; il nome della view che vogliamo visitare. Ti ricordi che questa <em>view</em> ha bisogno della variabile <code>pk</code>? Per passarla alla nostre views utilizziamo <code>pk=post.pk</code>, dove <code>post</code> &#xE8; il post appena creato!</p>
<p>Ok, abbiamo parlato abbastanza ora e forse sei curioso/a di vedere l&apos;aspetto della nostra <em>view</em>, giusto?</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_new</span><span class="hljs-params">(request)</span>:</span>
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:
        form = PostForm(request.POST)
        <span class="hljs-keyword">if</span> form.is_valid():
            post = form.save(commit=<span class="hljs-keyword">False</span>)
            post.author = request.user
            post.published_date = timezone.now()
            post.save()
            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&apos;post_detail&apos;</span>, pk=post.pk)
    <span class="hljs-keyword">else</span>:
        form = PostForm()
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Vediamo se funziona. Vai sulla pagina <a href="http://127.0.0.1:8000/post/new/" target="_blank">http://127.0.0.1:8000/post/new/</a>, aggiungi un <code>title</code> e un <code>text</code>, salvalo... e voil&#xE0;! Il tuo nuovo post &#xE8; stato aggiunto e noi siamo stati reindirizzati automaticamente alla pagina <code>post_detail</code> !</p>
<p>Forse avrai notato che stiamo impostando una data di pubblicazione prima di salvare il post. Pi&#xF9; tardi introdurremo l&apos;uso del <em>publish button</em> in <strong>Django Girls Tutorial: Extensions</strong>.</p>
<p>Fantastico!</p>
<h2 id="validazione-del-form">Validazione del Form</h2>
<p>E adesso ti dimostreremo quanto siano belli i form di Django. Sappiamo che un post ha bisogno di <code>title</code> e <code>text</code>. Nel nostro <code>Post</code> model non abbiamo detto (al contrario di quello che abbiamo fatto per <code>published_date</code>) che questi campi non sono obbligatori, per cui Django si aspetta che vengano impostati.</p>
<p>Prova a salvare il form senza <code>title</code> e <code>text</code>. Indovina che cosa accade!</p>
<p><img src="images/form_validation2.png" alt="Validazione del form"></p>
<p>Django si sta prendendo cura di controllare che tutti i campi nel nostro form siano corretti. Non &#xE8; fantastico?</p>
<blockquote>
<p>Dato che poco fa stavamo usando l&apos;interfaccia di Django admin, Django pensa che siamo ancora connessi. Ci sono alcune situazioni che potrebbero portarci a fare un log out(chiudere il browser, riavviare il DB etc.). Se ti trovi nella situazione di avere errori, quando crei un post, relativi alla mancanza di un utente, vai alla admin page <code>http://127.0.0.1:8000/admin</code> ed effettua il log in di nuovo. Questo risolver&#xE0; temporaneamente il problema. C&apos;&#xE8; una correzione permanente che ti aspetta nella sezione degli esercizi extra alla fine del tutorial principale <strong>Compiti: aggiungi sicurezza al tuo sito web!</strong>.</p>
</blockquote>
<p><img src="images/post_create_error.png" alt="Logged in error"></p>
<h2 id="modifica-il-form">Modifica il form</h2>
<p>Ora sappiamo come aggiungere un form. Ma cosa succede se ne vogliamo cambiare uno esistente? &#xC8; un processo abbastanza simile a quelli che abbiamo appena fatto. Creiamo alcune cose importanti rapidamente (se non capisci qualcosa, chiedi aiuto al tuo coach o guarda i capitoli precedenti, dal momento che abbiamo coperto tutti questi passaggi precedentemente).</p>
<p>Apri <code>blog/templates/blog/post_detail.html</code> e aggiungi:</p>
<pre><code class="lang-python">&lt;a class=&quot;btn btn-default&quot; href=&quot;{% url &apos;post_edit&apos; pk=post.pk %}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-pencil&quot;&gt;&lt;/span&gt;&lt;/a&gt;
</code></pre>
<p>per cui il tuo template sar&#xE0; cos&#xEC;:</p>
<pre><code class="lang-html">{% extends &apos;blog/base.html&apos; %}

{% block content %}
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>
        {% if post.published_date %}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;date&quot;</span>&gt;</span>
                {{ post.published_date }}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        {% endif %}
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-default&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_edit&apos; pk=post.pk %}&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-pencil&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{{ post.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ post.text|linebreaksbr }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
{% endblock %}
</code></pre>
<p>In <code>blog/urls.py</code> aggiugi:</p>
<pre><code class="lang-python">    url(<span class="hljs-string">r&apos;^post/(?P&lt;pk&gt;[0-9]+)/edit/$&apos;</span>, views.post_edit, name=<span class="hljs-string">&apos;post_edit&apos;</span>),
</code></pre>
<p>Riutilizzeremo il model <code>blog/templates/blog/post_edit.html</code>, quindi l&apos;ultima cosa che manca &#xE8; una <em>view</em>.</p>
<p>Apriamo <code>blog/views.py</code> e aggiungiamo alla fine del file:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_edit</span><span class="hljs-params">(request, pk)</span>:</span>
    post = get_object_or_404(Post, pk=pk)
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:
        form = PostForm(request.POST, instance=post)
        <span class="hljs-keyword">if</span> form.is_valid():
            post = form.save(commit=<span class="hljs-keyword">False</span>)
            post.author = request.user
            post.published_date = timezone.now()
            post.save()
            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&apos;post_detail&apos;</span>, pk=post.pk)
    <span class="hljs-keyword">else</span>:
        form = PostForm(instance=post)
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Questo sembra quasi esattamente la view <code>post_new</code>, giusto? Ma non del tutto. Prima cosa: si passa un parametro supplementare <code>pk</code> dall&apos;URL. Dopo di che: prendiamo il modello <code>Post</code> che vogliamo modificare con <code>get_object_or_404(Post, pk=pk)</code> e in seguito, quando creeremo un form, passeremo questo post come <code>instance</code>, sia quando salviamo il form:</p>
<pre><code class="lang-python">form = PostForm(request.POST, instance=post)
</code></pre>
<p>e quando abbiamo appena aperto un form con questo post da modificare:</p>
<pre><code class="lang-python">form = PostForm(instance=post)
</code></pre>
<p>Ok, testiamo se funziona! Andiamo alla pagina <code>post_detail</code>. Dovrebbe esserci un pulsante modifica nell&apos;angolo superiore destro:</p>
<p><img src="images/edit_button2.png" alt="Pulsante modifica"></p>
<p>Quando ci clicchi, vedrai il modulo con i nostri post del blog:</p>
<p><img src="images/edit_form2.png" alt="Modifica il form"></p>
<p>Sentiti libero di cambiare il titolo o il testo e salva le modifiche!</p>
<p>Complimenti! La tua application &#xE8; sempre pi&#xF9; completa!</p>
<p>Se ti servono altre informazioni sui forms di Django dovresti leggere la documentazione: <a href="https://docs.djangoproject.com/en/1.8/topics/forms/" target="_blank">https://docs.djangoproject.com/en/1.8/topics/forms/</a></p>
<h2 id="sicurezza">Sicurezza</h2>
<p>Riuscire a creare nuovi post semplicemente cliccando su un link &#xE8; bellissimo! Ma, al momento, chiunque visiti il tuo sito potrebbe pubblicare un nuovo post nel tuo blog e probabilmente non vuoi che ci&#xF2; accada. Facciamo in modo che questo tasto sia visibile solo per te e non per altri.</p>
<p>Vai al tuo <code>blog/templates/blog/base.html</code> e trova il <code>page-header</code> <code>div</code> con il tag di tipo anchor che hai messo prima. Dovrebbe apparire cos&#xEC;:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>Vogliamo aggiungere qui un altro tag del tipo <code>{% if %}</code> che far&#xE0; comparire il link solo per gli utenti connessi come admin. Per ora, solo tu! Cambia il tag <code>&lt;a&gt;</code> in modo che risulti cos&#xEC;:</p>
<pre><code class="lang-html">{% if user.is_authenticated %}
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
{% endif %}
</code></pre>
<p>Grazie a questo <code>{% if %}</code>, il link verr&#xE0; inviato al browser solo se l&apos;utente che prova ad accedere alla pagina &#xE8; connesso come admin. Con questa condizione non ci siamo protetti del tutto dalla creazione di nuovi post, ma abbiamo fatto un buon passo avanti. Nelle lezioni estensione ci occuperemo di pi&#xF9; della sicurezza.</p>
<p>Ora, dato che probabilmente sei connessa/o, se aggiorni la pagina non troverai alcuna differenza. Ma prova a ricaricare la pagina in un altro browser o in una finestra di navigazione in incognito e vedrai che il link non c&apos;&#xE8;!</p>
<h2 id="ultima-cosa-ora-di-fare-il-deploy">Ultima cosa: ora di fare il deploy!</h2>
<p>Vediamo se funziona su PythonAnywhere. &#xC8; l&apos;ora di un altro deploy!</p>
<ul>
<li>Innanzitutto, fai un commit del tuo nuovo codice e fai il push per caricarlo su GitHub</li>
</ul>
<pre><code>$ git status
$ git add --all .
$ git status
$ git commit -m &quot;Added views to create/edit blog post inside the site.&quot;
$ git push
</code></pre><ul>
<li>Poi, in una <a href="https://www.pythonanywhere.com/consoles/" target="_blank">console PythonAnywhere Bash</a>:</li>
</ul>
<pre><code>$ cd my-first-blog
$ source myvenv/bin/activate
(myvenv)$ git pull
[...]
(myvenv)$ python manage.py collectstatic
[...]
</code></pre><ul>
<li>Infine, vai sulla <a href="https://www.pythonanywhere.com/web_app_setup/" target="_blank">Web tab</a> e premi <strong>Reload</strong>.</li>
</ul>
<p>Fatto! Congratulazioni :)</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../extend_your_application/" class="navigation navigation-prev " aria-label="Previous page: Estendi la tua applicazione">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../whats_next/" class="navigation navigation-next " aria-label="Next page: Quali sono le prospettive?">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Form Django","level":"1.23","depth":1,"next":{"title":"Quali sono le prospettive?","level":"1.24","depth":1,"path":"whats_next/README.md","ref":"whats_next/README.md","articles":[]},"previous":{"title":"Estendi la tua applicazione","level":"1.22","depth":1,"path":"extend_your_application/README.md","ref":"extend_your_application/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["heading-anchors@1.0.3","ga@1.0.1","richquotes@0.0.9","github@2.0.0","language-picker","sidebar-ad","codeblock-label","sectionx"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"language-picker":{"grid-columns":3},"github":{"url":"https://github.com/DjangoGirls/tutorial"},"codeblock-label":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"richquotes":{"default":false},"sectionx":{"tag":"b"},"heading-anchors":{},"sidebar-ad":{"imageUrl":"https://cdn.shopify.com/s/files/1/0992/7712/products/codelikeagirl---mockup4_large.jpg","url":"https://store.djangogirls.org/","description":"💖 Support our work and buy a Django Girls t-shirt! ✨","btnText":"Get a t-shirt!"},"highlight":{},"ga":{"configuration":"auto","token":"UA-51680040-3"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"django_version":"2.0.6"},"language":"it","links":{"sidebar":{"Need help? Talk to us!":"https://gitter.im/DjangoGirls/tutorial"}},"gitbook":"*"},"file":{"path":"django_forms/README.md","mtime":"2018-08-10T14:46:00.090Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-08-10T15:23:12.236Z"},"basePath":"..","book":{"language":"it"}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sectionx/sectionx.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

